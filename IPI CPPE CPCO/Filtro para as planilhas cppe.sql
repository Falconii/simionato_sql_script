select     cab.id,cab.planilha,cab.sistema,cab.empresa,cab.local,cab.cnpj,cab.nro_linha,count(*)        
from       nfe_cab cab
inner join nfe_det det on cab.id = det.id and det.dtnf >= '2011-12-15'
--AND to_char(det.dtnf, 'YYYY') = '2014' AND  to_char(det.dtnf, 'MM') = '03'
where   ( cab.cnpj = '16622166000180' ) OR
        ( cab.cnpj = '16622166000260' ) OR 
        ( cab.cnpj = '16622166000341' ) OR
        ( cab.cnpj = '16622166000422' ) OR
        ( cab.cnpj = '16622166000503' ) OR
        ( cab.cnpj = '16622166000694' ) OR
        ( cab.cnpj = '16622166000775' ) OR
        ( cab.cnpj = '16622166000856' ) OR
        ( cab.cnpj = '16622166000937' ) OR
        ( cab.cnpj = '16622166001070' )
group by cab.id,cab.planilha,cab.sistema,cab.empresa,cab.local,cab.cnpj
order by cab.id,cab.planilha,cab.sistema,cab.empresa,cab.local,cab.cnpj

SELECT det.*,comp.*
FROM   nfe_det det
LEFT JOIN nfe_det_comp comp on comp.id = det.id and comp.nro_linha = det.nro_linha
WHERE  ( det.id = 1480    ) 



SELECT cab.planilha,cab.id,cab.nro_linha,(select count(*) from nfe_det_comp comp where comp.id = cab.id)
FROM   nfe_cab cab
WHERE  (( cab.id = 4     ) OR 
        ( cab.id = 9     ) OR 
        ( cab.id = 190   ) OR 
        ( cab.id = 191   ) OR 
        ( cab.id = 192   ) OR 
        ( cab.id = 193   ) OR 
        ( cab.id = 194   ) OR 
        ( cab.id = 195   ) OR 
        ( cab.id = 196   ) OR 
        ( cab.id = 197   ) OR 
        ( cab.id = 198   ) OR 
        ( cab.id = 199   ) OR 
        ( cab.id = 200   ) OR 
        ( cab.id = 201   ) OR 
        ( cab.id = 202   ) OR 
        ( cab.id = 203   ) OR 
        ( cab.id = 204   ) OR 
        ( cab.id = 205   ) OR 
        ( cab.id = 206   ) OR 
        ( cab.id = 207   ) OR 
        ( cab.id = 208   ) OR 
        ( cab.id = 209   ) OR 
        ( cab.id = 210   ) OR 
        ( cab.id = 211   ) OR 
        ( cab.id = 212   ) OR 
        ( cab.id = 213   ) OR 
        ( cab.id = 214   ) OR 
        ( cab.id = 215   ) OR 
        ( cab.id = 216   ) OR 
        ( cab.id = 217   ) OR 
        ( cab.id = 218   ) OR 
        ( cab.id = 219   ) OR 
        ( cab.id = 220   ) OR 
        ( cab.id = 221   ) OR 
        ( cab.id = 222   ) OR 
        ( cab.id = 223   ) OR 
        ( cab.id = 224   ) OR 
        ( cab.id = 225   ) OR 
        ( cab.id = 226   ) OR 
        ( cab.id = 227   ) OR 
        ( cab.id = 228   ) OR 
        ( cab.id = 229   ) OR 
        ( cab.id = 230   ) OR 
        ( cab.id = 231   ) OR 
        ( cab.id = 232   ) OR 
        ( cab.id = 233   ) OR 
        ( cab.id = 234   ) OR 
        ( cab.id = 235   ) OR 
        ( cab.id = 236   ) OR 
        ( cab.id = 237   ) OR 
        ( cab.id = 238   ) OR 
        ( cab.id = 239   ) OR 
        ( cab.id = 240   ) OR 
        ( cab.id = 241   ) OR 
        ( cab.id = 242   ) OR 
        ( cab.id = 243   ) OR 
        ( cab.id = 244   ) OR 
        ( cab.id = 245   ) OR 
        ( cab.id = 246   ) OR 
        ( cab.id = 247   ) OR 
        ( cab.id = 248   ) OR 
        ( cab.id = 249   ) OR 
        ( cab.id = 250   ) OR 
        ( cab.id = 251   ) OR 
        ( cab.id = 252   ) OR 
        ( cab.id = 253   ) OR 
        ( cab.id = 254   ) OR 
        ( cab.id = 255   ) OR 
        ( cab.id = 256   ) OR 
        ( cab.id = 257   ) OR 
        ( cab.id = 258   ) OR 
        ( cab.id = 259   ) OR 
        ( cab.id = 260   ) OR 
        ( cab.id = 261   ) OR 
        ( cab.id = 262   ) OR 
        ( cab.id = 263   ) OR 
        ( cab.id = 264   ) OR 
        ( cab.id = 265   ) OR 
        ( cab.id = 266   ) OR 
        ( cab.id = 267   ) OR 
        ( cab.id = 268   ) OR 
        ( cab.id = 269   ) OR 
        ( cab.id = 270   ) OR 
        ( cab.id = 271   ) OR 
        ( cab.id = 272   ) OR 
        ( cab.id = 273   ) OR 
        ( cab.id = 274   ) OR 
        ( cab.id = 275   ) OR 
        ( cab.id = 276   ) OR 
        ( cab.id = 1311  ) OR 
        ( cab.id = 1363  ) OR 
        ( cab.id = 1364  ) OR 
        ( cab.id = 1365  ) OR 
        ( cab.id = 1366  ) OR 
        ( cab.id = 1367  ) OR 
        ( cab.id = 1368  ) OR 
        ( cab.id = 1369  ) OR 
        ( cab.id = 1370  ) OR 
        ( cab.id = 1371  ) OR 
        ( cab.id = 1372  ) OR 
        ( cab.id = 1373  ) OR 
        ( cab.id = 1374  ) OR 
        ( cab.id = 1375  ) OR 
        ( cab.id = 1376  ) OR 
        ( cab.id = 1377  ) OR 
        ( cab.id = 1378  ) OR 
        ( cab.id = 1379  ) OR 
        ( cab.id = 1380  ) OR 
        ( cab.id = 1381  ) OR 
        ( cab.id = 1382  ) OR 
        ( cab.id = 1383  ) OR 
        ( cab.id = 1384  ) OR 
        ( cab.id = 1385  ) OR 
        ( cab.id = 1386  ) OR 
        ( cab.id = 1387  ) OR 
        ( cab.id = 1388  ) OR 
        ( cab.id = 1389  ) OR 
        ( cab.id = 1390  ) OR 
        ( cab.id = 1391  ) OR 
        ( cab.id = 1392  ) OR 
        ( cab.id = 1393  ) OR 
        ( cab.id = 1394  ) OR 
        ( cab.id = 1395  ) OR 
        ( cab.id = 1396  ) OR 
        ( cab.id = 1397  ) OR 
        ( cab.id = 1398  ) OR 
        ( cab.id = 1399  ) OR 
        ( cab.id = 1400  ) OR 
        ( cab.id = 1401  ) OR 
        ( cab.id = 1402  ) OR 
        ( cab.id = 1403  ) OR 
        ( cab.id = 1404  ) OR 
        ( cab.id = 1405  ) OR 
        ( cab.id = 1406  ) OR 
        ( cab.id = 1407  ) OR 
        ( cab.id = 1408  ) OR 
        ( cab.id = 1409  ) OR 
        ( cab.id = 1410  ) OR 
        ( cab.id = 1411  ) OR 
        ( cab.id = 1412  ) OR 
        ( cab.id = 1413  ) OR 
        ( cab.id = 1414  ) OR 
        ( cab.id = 1415  ) OR 
        ( cab.id = 1416  ) OR 
        ( cab.id = 1417  ) OR 
        ( cab.id = 1418  ) OR 
        ( cab.id = 1419  ) OR 
        ( cab.id = 1420  ) OR 
        ( cab.id = 1421  ) OR 
        ( cab.id = 1422  ) OR 
        ( cab.id = 1423  ) OR 
        ( cab.id = 1424  ) OR 
        ( cab.id = 1425  ) OR 
        ( cab.id = 1426  ) OR 
        ( cab.id = 1427  ) OR 
        ( cab.id = 1428  ) OR 
        ( cab.id = 1429  ) OR 
        ( cab.id = 1430  ) OR 
        ( cab.id = 1431  ) OR 
        ( cab.id = 1432  ) OR 
        ( cab.id = 1433  ) OR 
        ( cab.id = 1434  ) OR 
        ( cab.id = 1435  ) OR 
        ( cab.id = 1436  ) OR 
        ( cab.id = 1437  ) OR 
        ( cab.id = 1438  ) OR 
        ( cab.id = 1439  ) OR 
        ( cab.id = 1440  ) OR 
        ( cab.id = 1441  ) OR 
        ( cab.id = 1442  ) OR 
        ( cab.id = 1443  ) OR 
        ( cab.id = 1444  ) OR 
        ( cab.id = 1445  ) OR 
        ( cab.id = 1446 ) OR 
        ( cab.id = 1447 ) OR 
        ( cab.id = 1448 ) OR 
        ( cab.id = 1449 ) OR 
        ( cab.id = 1450 ) OR 
        ( cab.id = 1451 ) OR 
        ( cab.id = 1452 ) OR 
        ( cab.id = 1453 ) OR 
        ( cab.id = 1454 ) OR 
        ( cab.id = 1455 ) OR 
        ( cab.id = 1456 ) OR 
        ( cab.id = 1457 ) OR 
        ( cab.id = 1458 ) OR 
        ( cab.id = 1459 ) OR 
        ( cab.id = 1460 ) OR 
        ( cab.id = 1461 ) OR 
        ( cab.id = 1462 ) OR 
        ( cab.id = 1463 ) OR 
        ( cab.id = 1464 ) OR 
        ( cab.id = 1465 ) OR 
        ( cab.id = 1466 ) OR 
        ( cab.id = 1467 ) OR 
        ( cab.id = 1468 ) OR 
        ( cab.id = 1469 ) OR 
        ( cab.id = 1470 ) OR 
        ( cab.id = 1471 ) OR 
        ( cab.id = 1472 ) OR 
        ( cab.id = 1473 ) OR 
        ( cab.id = 1474 ) OR 
        ( cab.id = 1475 ) OR 
        ( cab.id = 1476 ) OR 
        ( cab.id = 1477 ) OR 
        ( cab.id = 1478 ) OR 
        ( cab.id = 1479 ) OR 
        ( cab.id = 1480 ) OR 
        ( cab.id = 1481 ) )


SELECT cab.planilha,cab.id,cab.nro_linha,(select count(*) from nfe_det_cfop cfop where cfop.id = cab.id)
FROM   nfe_cab cab
WHERE  (( cab.id = 4     ) OR 
        ( cab.id = 9     ) OR 
        ( cab.id = 190   ) OR 
        ( cab.id = 191   ) OR 
        ( cab.id = 192   ) OR 
        ( cab.id = 193   ) OR 
        ( cab.id = 194   ) OR 
        ( cab.id = 195   ) OR 
        ( cab.id = 196   ) OR 
        ( cab.id = 197   ) OR 
        ( cab.id = 198   ) OR 
        ( cab.id = 199   ) OR 
        ( cab.id = 200   ) OR 
        ( cab.id = 201   ) OR 
        ( cab.id = 202   ) OR 
        ( cab.id = 203   ) OR 
        ( cab.id = 204   ) OR 
        ( cab.id = 205   ) OR 
        ( cab.id = 206   ) OR 
        ( cab.id = 207   ) OR 
        ( cab.id = 208   ) OR 
        ( cab.id = 209   ) OR 
        ( cab.id = 210   ) OR 
        ( cab.id = 211   ) OR 
        ( cab.id = 212   ) OR 
        ( cab.id = 213   ) OR 
        ( cab.id = 214   ) OR 
        ( cab.id = 215   ) OR 
        ( cab.id = 216   ) OR 
        ( cab.id = 217   ) OR 
        ( cab.id = 218   ) OR 
        ( cab.id = 219   ) OR 
        ( cab.id = 220   ) OR 
        ( cab.id = 221   ) OR 
        ( cab.id = 222   ) OR 
        ( cab.id = 223   ) OR 
        ( cab.id = 224   ) OR 
        ( cab.id = 225   ) OR 
        ( cab.id = 226   ) OR 
        ( cab.id = 227   ) OR 
        ( cab.id = 228   ) OR 
        ( cab.id = 229   ) OR 
        ( cab.id = 230   ) OR 
        ( cab.id = 231   ) OR 
        ( cab.id = 232   ) OR 
        ( cab.id = 233   ) OR 
        ( cab.id = 234   ) OR 
        ( cab.id = 235   ) OR 
        ( cab.id = 236   ) OR 
        ( cab.id = 237   ) OR 
        ( cab.id = 238   ) OR 
        ( cab.id = 239   ) OR 
        ( cab.id = 240   ) OR 
        ( cab.id = 241   ) OR 
        ( cab.id = 242   ) OR 
        ( cab.id = 243   ) OR 
        ( cab.id = 244   ) OR 
        ( cab.id = 245   ) OR 
        ( cab.id = 246   ) OR 
        ( cab.id = 247   ) OR 
        ( cab.id = 248   ) OR 
        ( cab.id = 249   ) OR 
        ( cab.id = 250   ) OR 
        ( cab.id = 251   ) OR 
        ( cab.id = 252   ) OR 
        ( cab.id = 253   ) OR 
        ( cab.id = 254   ) OR 
        ( cab.id = 255   ) OR 
        ( cab.id = 256   ) OR 
        ( cab.id = 257   ) OR 
        ( cab.id = 258   ) OR 
        ( cab.id = 259   ) OR 
        ( cab.id = 260   ) OR 
        ( cab.id = 261   ) OR 
        ( cab.id = 262   ) OR 
        ( cab.id = 263   ) OR 
        ( cab.id = 264   ) OR 
        ( cab.id = 265   ) OR 
        ( cab.id = 266   ) OR 
        ( cab.id = 267   ) OR 
        ( cab.id = 268   ) OR 
        ( cab.id = 269   ) OR 
        ( cab.id = 270   ) OR 
        ( cab.id = 271   ) OR 
        ( cab.id = 272   ) OR 
        ( cab.id = 273   ) OR 
        ( cab.id = 274   ) OR 
        ( cab.id = 275   ) OR 
        ( cab.id = 276   ) OR 
        ( cab.id = 1311  ) OR 
        ( cab.id = 1363  ) OR 
        ( cab.id = 1364  ) OR 
        ( cab.id = 1365  ) OR 
        ( cab.id = 1366  ) OR 
        ( cab.id = 1367  ) OR 
        ( cab.id = 1368  ) OR 
        ( cab.id = 1369  ) OR 
        ( cab.id = 1370  ) OR 
        ( cab.id = 1371  ) OR 
        ( cab.id = 1372  ) OR 
        ( cab.id = 1373  ) OR 
        ( cab.id = 1374  ) OR 
        ( cab.id = 1375  ) OR 
        ( cab.id = 1376  ) OR 
        ( cab.id = 1377  ) OR 
        ( cab.id = 1378  ) OR 
        ( cab.id = 1379  ) OR 
        ( cab.id = 1380  ) OR 
        ( cab.id = 1381  ) OR 
        ( cab.id = 1382  ) OR 
        ( cab.id = 1383  ) OR 
        ( cab.id = 1384  ) OR 
        ( cab.id = 1385  ) OR 
        ( cab.id = 1386  ) OR 
        ( cab.id = 1387  ) OR 
        ( cab.id = 1388  ) OR 
        ( cab.id = 1389  ) OR 
        ( cab.id = 1390  ) OR 
        ( cab.id = 1391  ) OR 
        ( cab.id = 1392  ) OR 
        ( cab.id = 1393  ) OR 
        ( cab.id = 1394  ) OR 
        ( cab.id = 1395  ) OR 
        ( cab.id = 1396  ) OR 
        ( cab.id = 1397  ) OR 
        ( cab.id = 1398  ) OR 
        ( cab.id = 1399  ) OR 
        ( cab.id = 1400  ) OR 
        ( cab.id = 1401  ) OR 
        ( cab.id = 1402  ) OR 
        ( cab.id = 1403  ) OR 
        ( cab.id = 1404  ) OR 
        ( cab.id = 1405  ) OR 
        ( cab.id = 1406  ) OR 
        ( cab.id = 1407  ) OR 
        ( cab.id = 1408  ) OR 
        ( cab.id = 1409  ) OR 
        ( cab.id = 1410  ) OR 
        ( cab.id = 1411  ) OR 
        ( cab.id = 1412  ) OR 
        ( cab.id = 1413  ) OR 
        ( cab.id = 1414  ) OR 
        ( cab.id = 1415  ) OR 
        ( cab.id = 1416  ) OR 
        ( cab.id = 1417  ) OR 
        ( cab.id = 1418  ) OR 
        ( cab.id = 1419  ) OR 
        ( cab.id = 1420  ) OR 
        ( cab.id = 1421  ) OR 
        ( cab.id = 1422  ) OR 
        ( cab.id = 1423  ) OR 
        ( cab.id = 1424  ) OR 
        ( cab.id = 1425  ) OR 
        ( cab.id = 1426  ) OR 
        ( cab.id = 1427  ) OR 
        ( cab.id = 1428  ) OR 
        ( cab.id = 1429  ) OR 
        ( cab.id = 1430  ) OR 
        ( cab.id = 1431  ) OR 
        ( cab.id = 1432  ) OR 
        ( cab.id = 1433  ) OR 
        ( cab.id = 1434  ) OR 
        ( cab.id = 1435  ) OR 
        ( cab.id = 1436  ) OR 
        ( cab.id = 1437  ) OR 
        ( cab.id = 1438  ) OR 
        ( cab.id = 1439  ) OR 
        ( cab.id = 1440  ) OR 
        ( cab.id = 1441  ) OR 
        ( cab.id = 1442  ) OR 
        ( cab.id = 1443  ) OR 
        ( cab.id = 1444  ) OR 
        ( cab.id = 1445  ) OR 
        ( cab.id = 1446 ) OR 
        ( cab.id = 1447 ) OR 
        ( cab.id = 1448 ) OR 
        ( cab.id = 1449 ) OR 
        ( cab.id = 1450 ) OR 
        ( cab.id = 1451 ) OR 
        ( cab.id = 1452 ) OR 
        ( cab.id = 1453 ) OR 
        ( cab.id = 1454 ) OR 
        ( cab.id = 1455 ) OR 
        ( cab.id = 1456 ) OR 
        ( cab.id = 1457 ) OR 
        ( cab.id = 1458 ) OR 
        ( cab.id = 1459 ) OR 
        ( cab.id = 1460 ) OR 
        ( cab.id = 1461 ) OR 
        ( cab.id = 1462 ) OR 
        ( cab.id = 1463 ) OR 
        ( cab.id = 1464 ) OR 
        ( cab.id = 1465 ) OR 
        ( cab.id = 1466 ) OR 
        ( cab.id = 1467 ) OR 
        ( cab.id = 1468 ) OR 
        ( cab.id = 1469 ) OR 
        ( cab.id = 1470 ) OR 
        ( cab.id = 1471 ) OR 
        ( cab.id = 1472 ) OR 
        ( cab.id = 1473 ) OR 
        ( cab.id = 1474 ) OR 
        ( cab.id = 1475 ) OR 
        ( cab.id = 1476 ) OR 
        ( cab.id = 1477 ) OR 
        ( cab.id = 1478 ) OR 
        ( cab.id = 1479 ) OR 
        ( cab.id = 1480 ) OR 
        ( cab.id = 1481 ) )

SELECT CFOP,TAG,DESCRICAO FROM NFE_DET_CFOP WHERE TAG <> '' AND (CFOP = '5910' OR CFOP = '6910')  GROUP BY CFOP,TAG,DESCRICAO

