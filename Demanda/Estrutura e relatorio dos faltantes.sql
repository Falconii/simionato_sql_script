
--
-- Ativa as funcoes de pivot
//CREATE EXTENSION tablefunc
//go

//PRÉ-REQUISITOS
//Dropar arquivo SE EXISTIR 
//TEMPORARIO_ACUMULADO_DATA_QTD_NF

//Dropar se existir e Criar arquivo 
//ACUMULADO_DATA_QTD_NF

DROP TABLE ACUMULADO_DATA_QTD_NF_DEMA;
GO
DROP TABLE TEMPORARIO_ACUMULADO_DATA_QTD_NF_DEMA
GO

CREATE TABLE public.ACUMULADO_DATA_QTD_NF_DEMA  ( 
    id_demanda  int4        NOT NULL,
	cnpj     	varchar(14) NOT NULL,
	ano      	varchar(4) NOT NULL,
	mes      	varchar(2) NOT NULL,
	total_nfe	int4 NULL,
	PRIMARY KEY(id_demanda,cnpj,ano,mes) 
	)
WITHOUT OIDS 
TABLESPACE "Producao"
GO



//Geração do acumulado temporario
SELECT  TABELA.CNPJ,
        TABELA.ANO, 
        TABELA.MES,
        TABELA.QTD
        INTO TABLE TEMPORARIO_ACUMULADO_DATA_QTD_NF_DEMA
FROM 
(
    SELECT 
    1                   AS ID_DEMANDA,
    NOTAS.CNPJ          AS CNPJ,
    to_char(NOTAS.dtnf,'YYYY') AS ANO, 
    to_char(NOTAS.dtnf,'MM')   AS MES,
    COUNT(*) as QTD
    FROM (
       SELECT DISTINCT 
       
       CAB.CNPJ AS CNPJ,
       DET.DTNF AS DTNF,
       DET.SERIE AS SERIE,
       DET.NRO   AS NRO
       FROM NFE_DET DET
       INNER JOIN NFE_CAB CAB ON DET.ID = CAB.ID 
       ORDER BY CAB.CNPJ,2
       ) AS NOTAS
    GROUP BY NOTAS.CNPJ,2,3
    ORDER BY NOTAS.CNPJ,2,3

) AS TABELA
ORDER BY 
        TABELA.CNPJ,
        TABELA.ANO, 
        TABELA.MES
GO

//GRAVANDO NO ACUMULADO OFICIAL
INSERT INTO ACUMULADO_DATA_QTD_NF(
    CNPJ, 
    ANO, 
    MES,
    TOTAL_NFE
 ) 
     SELECT 
       CNPJ, 
       ANO, 
       MES,
       QTD
     FROM TEMPORARIO_ACUMULADO_DATA_QTD_NF
     ORDER BY CNPJ,ANO,MES;
go


//Rode até aqui para criar a estrutura, só depois rode os scripts do relatorio

-- Listagem dos faltantes 2008 - 2022
select
  "CNPJ",
  "UNIDADE",
  "EMPRESA",
  coalesce("Jan/2008",0)  as  "Jan/2008" ,
  coalesce("Fev/2008",0)  as  "Fev/2008" ,
  coalesce("Mar/2008",0)  as  "Mar/2008" ,
  coalesce("Abr/2008",0)  as  "Abr/2008" ,
  coalesce("Mai/2008",0)  as  "Mai/2008" ,
  coalesce("Jun/2008",0)  as  "Jun/2008" ,
  coalesce("Jul/2008",0)  as  "Jul/2008" ,
  coalesce("Ago/2008",0)  as  "Ago/2008" ,
  coalesce("Set/2008",0)  as  "Set/2008" ,
  coalesce("Out/2008",0)  as  "Out/2008" ,
  coalesce("Nov/2008",0)  as  "Nov/2008" ,
  coalesce("Dez/2008",0)  as  "Dez/2008" ,
  coalesce("Jan/2009",0)  as  "Jan/2009" ,
  coalesce("Fev/2009",0)  as  "Fev/2009" ,
  coalesce("Mar/2009",0)  as  "Mar/2009" ,
  coalesce("Abr/2009",0)  as  "Abr/2009" ,
  coalesce("Mai/2009",0)  as  "Mai/2009" ,
  coalesce("Jun/2009",0)  as  "Jun/2009" ,
  coalesce("Jul/2009",0)  as  "Jul/2009" ,
  coalesce("Ago/2009",0)  as  "Ago/2009" ,
  coalesce("Set/2009",0)  as  "Set/2009" ,
  coalesce("Out/2009",0)  as  "Out/2009" ,
  coalesce("Nov/2009",0)  as  "Nov/2009" ,
  coalesce("Dez/2009",0)  as  "Dez/2009" ,
  coalesce("Jan/2010",0)  as  "Jan/2010" ,
  coalesce("Fev/2010",0)  as  "Fev/2010" ,
  coalesce("Mar/2010",0)  as  "Mar/2010" ,
  coalesce("Abr/2010",0)  as  "Abr/2010" ,
  coalesce("Mai/2010",0)  as  "Mai/2010" ,
  coalesce("Jun/2010",0)  as  "Jun/2010" ,
  coalesce("Jul/2010",0)  as  "Jul/2010" ,
  coalesce("Ago/2010",0)  as  "Ago/2010" ,
  coalesce("Set/2010",0)  as  "Set/2010" ,
  coalesce("Out/2010",0)  as  "Out/2010" ,
  coalesce("Nov/2010",0)  as  "Nov/2010" ,
  coalesce("Dez/2010",0)  as  "Dez/2010" ,
  coalesce("Jan/2011",0)  as  "Jan/2011" ,
  coalesce("Fev/2011",0)  as  "Fev/2011" ,
  coalesce("Mar/2011",0)  as  "Mar/2011" ,
  coalesce("Abr/2011",0)  as  "Abr/2011" ,
  coalesce("Mai/2011",0)  as  "Mai/2011" ,
  coalesce("Jun/2011",0)  as  "Jun/2011" ,
  coalesce("Jul/2011",0)  as  "Jul/2011" ,
  coalesce("Ago/2011",0)  as  "Ago/2011" ,
  coalesce("Set/2011",0)  as  "Set/2011" ,
  coalesce("Out/2011",0)  as  "Out/2011" ,
  coalesce("Nov/2011",0)  as  "Nov/2011" ,
  coalesce("Dez/2011",0)  as  "Dez/2011" ,
  coalesce("Jan/2012",0)  as  "Jan/2012" ,
  coalesce("Fev/2012",0)  as  "Fev/2012" ,
  coalesce("Mar/2012",0)  as  "Mar/2012" ,
  coalesce("Abr/2012",0)  as  "Abr/2012" ,
  coalesce("Mai/2012",0)  as  "Mai/2012" ,
  coalesce("Jun/2012",0)  as  "Jun/2012" ,
  coalesce("Jul/2012",0)  as  "Jul/2012" ,
  coalesce("Ago/2012",0)  as  "Ago/2012" ,
  coalesce("Set/2012",0)  as  "Set/2012" ,
  coalesce("Out/2012",0)  as  "Out/2012" ,
  coalesce("Nov/2012",0)  as  "Nov/2012" ,
  coalesce("Dez/2012",0)  as  "Dez/2012" ,
  coalesce("Jan/2013",0)  as  "Jan/2013" ,
  coalesce("Fev/2013",0)  as  "Fev/2013" ,
  coalesce("Mar/2013",0)  as  "Mar/2013" ,
  coalesce("Abr/2013",0)  as  "Abr/2013" ,
  coalesce("Mai/2013",0)  as  "Mai/2013" ,
  coalesce("Jun/2013",0)  as  "Jun/2013" ,
  coalesce("Jul/2013",0)  as  "Jul/2013" ,
  coalesce("Ago/2013",0)  as  "Ago/2013" ,
  coalesce("Set/2013",0)  as  "Set/2013" ,
  coalesce("Out/2013",0)  as  "Out/2013" ,
  coalesce("Nov/2013",0)  as  "Nov/2013" ,
  coalesce("Dez/2013",0)  as  "Dez/2013" ,
  coalesce("Jan/2014",0)  as  "Jan/2014" ,
  coalesce("Fev/2014",0)  as  "Fev/2014" ,
  coalesce("Mar/2014",0)  as  "Mar/2014" ,
  coalesce("Abr/2014",0)  as  "Abr/2014" ,
  coalesce("Mai/2014",0)  as  "Mai/2014" ,
  coalesce("Jun/2014",0)  as  "Jun/2014" ,
  coalesce("Jul/2014",0)  as  "Jul/2014" ,
  coalesce("Ago/2014",0)  as  "Ago/2014" ,
  coalesce("Set/2014",0)  as  "Set/2014" ,
  coalesce("Out/2014",0)  as  "Out/2014" ,
  coalesce("Nov/2014",0)  as  "Nov/2014" ,
  coalesce("Dez/2014",0)  as  "Dez/2014" ,
  coalesce("Jan/2015",0)  as  "Jan/2015" ,
  coalesce("Fev/2015",0)  as  "Fev/2015" ,
  coalesce("Mar/2015",0)  as  "Mar/2015" ,
  coalesce("Abr/2015",0)  as  "Abr/2015" ,
  coalesce("Mai/2015",0)  as  "Mai/2015" ,
  coalesce("Jun/2015",0)  as  "Jun/2015" ,
  coalesce("Jul/2015",0)  as  "Jul/2015" ,
  coalesce("Ago/2015",0)  as  "Ago/2015" ,
  coalesce("Set/2015",0)  as  "Set/2015" ,
  coalesce("Out/2015",0)  as  "Out/2015" ,
  coalesce("Nov/2015",0)  as  "Nov/2015" ,
  coalesce("Dez/2015",0)  as  "Dez/2015" ,
  coalesce("Jan/2016",0)  as  "Jan/2016" ,
  coalesce("Fev/2016",0)  as  "Fev/2016" ,
  coalesce("Mar/2016",0)  as  "Mar/2016" ,
  coalesce("Abr/2016",0)  as  "Abr/2016" ,
  coalesce("Mai/2016",0)  as  "Mai/2016" ,
  coalesce("Jun/2016",0)  as  "Jun/2016" ,
  coalesce("Jul/2016",0)  as  "Jul/2016" ,
  coalesce("Ago/2016",0)  as  "Ago/2016" ,
  coalesce("Set/2016",0)  as  "Set/2016" ,
  coalesce("Out/2016",0)  as  "Out/2016" ,
  coalesce("Nov/2016",0)  as  "Nov/2016" ,
  coalesce("Dez/2016",0)  as  "Dez/2016" ,
  coalesce("Jan/2017",0)  as  "Jan/2017" ,
  coalesce("Fev/2017",0)  as  "Fev/2017" ,
  coalesce("Mar/2017",0)  as  "Mar/2017" ,
  coalesce("Abr/2017",0)  as  "Abr/2017" ,
  coalesce("Mai/2017",0)  as  "Mai/2017" ,
  coalesce("Jun/2017",0)  as  "Jun/2017" ,
  coalesce("Jul/2017",0)  as  "Jul/2017" ,
  coalesce("Ago/2017",0)  as  "Ago/2017" ,
  coalesce("Set/2017",0)  as  "Set/2017" ,
  coalesce("Out/2017",0)  as  "Out/2017" ,
  coalesce("Nov/2017",0)  as  "Nov/2017" ,
  coalesce("Dez/2017",0)  as  "Dez/2017" ,
  coalesce("Jan/2018",0)  as  "Jan/2018" ,
  coalesce("Fev/2018",0)  as  "Fev/2018" ,
  coalesce("Mar/2018",0)  as  "Mar/2018" ,
  coalesce("Abr/2018",0)  as  "Abr/2018" ,
  coalesce("Mai/2018",0)  as  "Mai/2018" ,
  coalesce("Jun/2018",0)  as  "Jun/2018" ,
  coalesce("Jul/2018",0)  as  "Jul/2018" ,
  coalesce("Ago/2018",0)  as  "Ago/2018" ,
  coalesce("Set/2018",0)  as  "Set/2018" ,
  coalesce("Out/2018",0)  as  "Out/2018" ,
  coalesce("Nov/2018",0)  as  "Nov/2018" ,
  coalesce("Dez/2018",0)  as  "Dez/2018" ,
  coalesce("Jan/2019",0)  as  "Jan/2019" ,
  coalesce("Fev/2019",0)  as  "Fev/2019" ,
  coalesce("Mar/2019",0)  as  "Mar/2019" ,
  coalesce("Abr/2019",0)  as  "Abr/2019" ,
  coalesce("Mai/2019",0)  as  "Mai/2019" ,
  coalesce("Jun/2019",0)  as  "Jun/2019" ,
  coalesce("Jul/2019",0)  as  "Jul/2019" ,
  coalesce("Ago/2019",0)  as  "Ago/2019" ,
  coalesce("Set/2019",0)  as  "Set/2019" ,
  coalesce("Out/2019",0)  as  "Out/2019" ,
  coalesce("Nov/2019",0)  as  "Nov/2019" ,
  coalesce("Dez/2019",0)  as  "Dez/2019" ,
  coalesce("Jan/2020",0)  as  "Jan/2020" ,
  coalesce("Fev/2020",0)  as  "Fev/2020" ,
  coalesce("Mar/2020",0)  as  "Mar/2020" ,
  coalesce("Abr/2020",0)  as  "Abr/2020" ,
  coalesce("Mai/2020",0)  as  "Mai/2020" ,
  coalesce("Jun/2020",0)  as  "Jun/2020" ,
  coalesce("Jul/2020",0)  as  "Jul/2020" ,
  coalesce("Ago/2020",0)  as  "Ago/2020" ,
  coalesce("Set/2020",0)  as  "Set/2020" ,
  coalesce("Out/2020",0)  as  "Out/2020" ,
  coalesce("Nov/2020",0)  as  "Nov/2020" ,
  coalesce("Dez/2020",0)  as  "Dez/2020" ,
  coalesce("Jan/2021",0)  as  "Jan/2021" ,
  coalesce("Fev/2021",0)  as  "Fev/2021" ,
  coalesce("Mar/2021",0)  as  "Mar/2021" ,
  coalesce("Abr/2021",0)  as  "Abr/2021" ,
  coalesce("Mai/2021",0)  as  "Mai/2021" ,
  coalesce("Jun/2021",0)  as  "Jun/2021" ,
  coalesce("Jul/2021",0)  as  "Jul/2021" ,
  coalesce("Ago/2021",0)  as  "Ago/2021" ,
  coalesce("Set/2021",0)  as  "Set/2021" ,
  coalesce("Out/2021",0)  as  "Out/2021" ,
  coalesce("Nov/2021",0)  as  "Nov/2021" ,
  coalesce("Dez/2021",0)  as  "Dez/2021" ,
  coalesce("Jan/2021",0)  as  "Jan/2021" ,
  coalesce("Fev/2021",0)  as  "Fev/2021" ,
  coalesce("Mar/2021",0)  as  "Mar/2021" ,
  coalesce("Abr/2021",0)  as  "Abr/2021" ,
  coalesce("Mai/2021",0)  as  "Mai/2021" ,
  coalesce("Jun/2021",0)  as  "Jun/2021" ,
  coalesce("Jul/2021",0)  as  "Jul/2021" ,
  coalesce("Ago/2021",0)  as  "Ago/2021" ,
  coalesce("Set/2021",0)  as  "Set/2021" ,
  coalesce("Out/2021",0)  as  "Out/2021" ,
  coalesce("Nov/2021",0)  as  "Nov/2021" ,
  coalesce("Dez/2021",0)  as  "Dez/2021" ,
  coalesce("Jan/2022",0)  as  "Jan/2022" ,
  coalesce("Fev/2022",0)  as  "Fev/2022" ,
  coalesce("Mar/2022",0)  as  "Mar/2022" ,
  coalesce("Abr/2022",0)  as  "Abr/2022" ,
  coalesce("Mai/2022",0)  as  "Mai/2022" ,
  coalesce("Jun/2022",0)  as  "Jun/2022" ,
  coalesce("Jul/2022",0)  as  "Jul/2022" ,
  coalesce("Ago/2022",0)  as  "Ago/2022" ,
  coalesce("Set/2022",0)  as  "Set/2022" ,
  coalesce("Out/2022",0)  as  "Out/2022" ,
  coalesce("Nov/2022",0)  as  "Nov/2022" ,
  coalesce("Dez/2022",0)  as  "Dez/2022" 
  from crosstab('SELECT acu.cnpj,depara.unid,depara.empresa,((cast(acu.ano as integer)-2007-1)*12+cast(acu.mes as integer)) as mes,acu.total_nfe FROM acumulado_data_qtd_nf acu left join depara on depara.cnpj = acu.cnpj order by acu.cnpj ',
                'select m from generate_series(1,180) m') as  ct(
  "CNPJ" text,
  "UNIDADE" text,
  "EMPRESA" text,
  "Jan/2008" numeric(10,2),
  "Fev/2008" numeric(10,2),
  "Mar/2008" numeric(10,2),
  "Abr/2008" numeric(10,2),
  "Mai/2008" numeric(10,2),
  "Jun/2008" numeric(10,2),
  "Jul/2008" numeric(10,2),
  "Ago/2008" numeric(10,2),
  "Set/2008" numeric(10,2),
  "Out/2008" numeric(10,2),
  "Nov/2008" numeric(10,2),
  "Dez/2008" numeric(10,2),
  "Jan/2009" numeric(10,2),
  "Fev/2009" numeric(10,2),
  "Mar/2009" numeric(10,2),
  "Abr/2009" numeric(10,2),
  "Mai/2009" numeric(10,2),
  "Jun/2009" numeric(10,2),
  "Jul/2009" numeric(10,2),
  "Ago/2009" numeric(10,2),
  "Set/2009" numeric(10,2),
  "Out/2009" numeric(10,2),
  "Nov/2009" numeric(10,2),
  "Dez/2009" numeric(10,2),
  "Jan/2010" numeric(10,2),
  "Fev/2010" numeric(10,2),
  "Mar/2010" numeric(10,2),
  "Abr/2010" numeric(10,2),
  "Mai/2010" numeric(10,2),
  "Jun/2010" numeric(10,2),
  "Jul/2010" numeric(10,2),
  "Ago/2010" numeric(10,2),
  "Set/2010" numeric(10,2),
  "Out/2010" numeric(10,2),
  "Nov/2010" numeric(10,2),
  "Dez/2010" numeric(10,2),
  "Jan/2011" numeric(10,2),
  "Fev/2011" numeric(10,2),
  "Mar/2011" numeric(10,2),
  "Abr/2011" numeric(10,2),
  "Mai/2011" numeric(10,2),
  "Jun/2011" numeric(10,2),
  "Jul/2011" numeric(10,2),
  "Ago/2011" numeric(10,2),
  "Set/2011" numeric(10,2),
  "Out/2011" numeric(10,2),
  "Nov/2011" numeric(10,2),
  "Dez/2011" numeric(10,2),
  "Jan/2012" numeric(10,2),
  "Fev/2012" numeric(10,2),
  "Mar/2012" numeric(10,2),
  "Abr/2012" numeric(10,2),
  "Mai/2012" numeric(10,2),
  "Jun/2012" numeric(10,2),
  "Jul/2012" numeric(10,2),
  "Ago/2012" numeric(10,2),
  "Set/2012" numeric(10,2),
  "Out/2012" numeric(10,2),
  "Nov/2012" numeric(10,2),
  "Dez/2012" numeric(10,2),
  "Jan/2013" numeric(10,2),
  "Fev/2013" numeric(10,2),
  "Mar/2013" numeric(10,2),
  "Abr/2013" numeric(10,2),
  "Mai/2013" numeric(10,2),
  "Jun/2013" numeric(10,2),
  "Jul/2013" numeric(10,2),
  "Ago/2013" numeric(10,2),
  "Set/2013" numeric(10,2),
  "Out/2013" numeric(10,2),
  "Nov/2013" numeric(10,2),
  "Dez/2013" numeric(10,2),
  "Jan/2014" numeric(10,2),
  "Fev/2014" numeric(10,2),
  "Mar/2014" numeric(10,2),
  "Abr/2014" numeric(10,2),
  "Mai/2014" numeric(10,2),
  "Jun/2014" numeric(10,2),
  "Jul/2014" numeric(10,2),
  "Ago/2014" numeric(10,2),
  "Set/2014" numeric(10,2),
  "Out/2014" numeric(10,2),
  "Nov/2014" numeric(10,2),
  "Dez/2014" numeric(10,2),
  "Jan/2015" numeric(10,2),
  "Fev/2015" numeric(10,2),
  "Mar/2015" numeric(10,2),
  "Abr/2015" numeric(10,2),
  "Mai/2015" numeric(10,2),
  "Jun/2015" numeric(10,2),
  "Jul/2015" numeric(10,2),
  "Ago/2015" numeric(10,2),
  "Set/2015" numeric(10,2),
  "Out/2015" numeric(10,2),
  "Nov/2015" numeric(10,2),
  "Dez/2015" numeric(10,2),
  "Jan/2016" numeric(10,2),
  "Fev/2016" numeric(10,2),
  "Mar/2016" numeric(10,2),
  "Abr/2016" numeric(10,2),
  "Mai/2016" numeric(10,2),
  "Jun/2016" numeric(10,2),
  "Jul/2016" numeric(10,2),
  "Ago/2016" numeric(10,2),
  "Set/2016" numeric(10,2),
  "Out/2016" numeric(10,2),
  "Nov/2016" numeric(10,2),
  "Dez/2016" numeric(10,2),
  "Jan/2017" numeric(10,2),
  "Fev/2017" numeric(10,2),
  "Mar/2017" numeric(10,2),
  "Abr/2017" numeric(10,2),
  "Mai/2017" numeric(10,2),
  "Jun/2017" numeric(10,2),
  "Jul/2017" numeric(10,2),
  "Ago/2017" numeric(10,2),
  "Set/2017" numeric(10,2),
  "Out/2017" numeric(10,2),
  "Nov/2017" numeric(10,2),
  "Dez/2017" numeric(10,2),
  "Jan/2018" numeric(10,2),
  "Fev/2018" numeric(10,2),
  "Mar/2018" numeric(10,2),
  "Abr/2018" numeric(10,2),
  "Mai/2018" numeric(10,2),
  "Jun/2018" numeric(10,2),
  "Jul/2018" numeric(10,2),
  "Ago/2018" numeric(10,2),
  "Set/2018" numeric(10,2),
  "Out/2018" numeric(10,2),
  "Nov/2018" numeric(10,2),
  "Dez/2018" numeric(10,2),
  "Jan/2019" numeric(10,2),
  "Fev/2019" numeric(10,2),
  "Mar/2019" numeric(10,2),
  "Abr/2019" numeric(10,2),
  "Mai/2019" numeric(10,2),
  "Jun/2019" numeric(10,2),
  "Jul/2019" numeric(10,2),
  "Ago/2019" numeric(10,2),
  "Set/2019" numeric(10,2),
  "Out/2019" numeric(10,2),
  "Nov/2019" numeric(10,2),
  "Dez/2019" numeric(10,2),
  "Jan/2020" numeric(10,2),
  "Fev/2020" numeric(10,2),
  "Mar/2020" numeric(10,2),
  "Abr/2020" numeric(10,2),
  "Mai/2020" numeric(10,2),
  "Jun/2020" numeric(10,2),
  "Jul/2020" numeric(10,2),
  "Ago/2020" numeric(10,2),
  "Set/2020" numeric(10,2),
  "Out/2020" numeric(10,2),
  "Nov/2020" numeric(10,2),
  "Dez/2020" numeric(10,2),
  "Jan/2021" numeric(10,2),
  "Fev/2021" numeric(10,2),
  "Mar/2021" numeric(10,2),
  "Abr/2021" numeric(10,2),
  "Mai/2021" numeric(10,2),
  "Jun/2021" numeric(10,2),
  "Jul/2021" numeric(10,2),
  "Ago/2021" numeric(10,2),
  "Set/2021" numeric(10,2),
  "Out/2021" numeric(10,2),
  "Nov/2021" numeric(10,2),
  "Dez/2021" numeric(10,2),
  "Jan/2022" numeric(10,2),
  "Fev/2022" numeric(10,2),
  "Mar/2022" numeric(10,2),
  "Abr/2022" numeric(10,2),
  "Mai/2022" numeric(10,2),
  "Jun/2022" numeric(10,2),
  "Jul/2022" numeric(10,2),
  "Ago/2022" numeric(10,2),
  "Set/2022" numeric(10,2),
  "Out/2022" numeric(10,2),
  "Nov/2022" numeric(10,2),
  "Dez/2022" numeric(10,2)
);
GO
-- Listagem dos faltantes de 2001- 2007
select
  "CNPJ",
  "UNIDADE",
  coalesce("Jan/2001",0)  as  "Jan/2001" ,
  coalesce("Fev/2001",0)  as  "Fev/2001" ,
  coalesce("Mar/2001",0)  as  "Mar/2001" ,
  coalesce("Abr/2001",0)  as  "Abr/2001" ,
  coalesce("Mai/2001",0)  as  "Mai/2001" ,
  coalesce("Jun/2001",0)  as  "Jun/2001" ,
  coalesce("Jul/2001",0)  as  "Jul/2001" ,
  coalesce("Ago/2001",0)  as  "Ago/2001" ,
  coalesce("Set/2001",0)  as  "Set/2001" ,
  coalesce("Out/2001",0)  as  "Out/2001" ,
  coalesce("Nov/2001",0)  as  "Nov/2001" ,
  coalesce("Dez/2001",0)  as  "Dez/2001" ,
  coalesce("Jan/2002",0)  as  "Jan/2002" ,
  coalesce("Fev/2002",0)  as  "Fev/2002" ,
  coalesce("Mar/2002",0)  as  "Mar/2002" ,
  coalesce("Abr/2002",0)  as  "Abr/2002" ,
  coalesce("Mai/2002",0)  as  "Mai/2002" ,
  coalesce("Jun/2002",0)  as  "Jun/2002" ,
  coalesce("Jul/2002",0)  as  "Jul/2002" ,
  coalesce("Ago/2002",0)  as  "Ago/2002" ,
  coalesce("Set/2002",0)  as  "Set/2002" ,
  coalesce("Out/2002",0)  as  "Out/2002" ,
  coalesce("Nov/2002",0)  as  "Nov/2002" ,
  coalesce("Dez/2002",0)  as  "Dez/2002" ,
  coalesce("Jan/2003",0)  as  "Jan/2003" ,
  coalesce("Fev/2003",0)  as  "Fev/2003" ,
  coalesce("Mar/2003",0)  as  "Mar/2003" ,
  coalesce("Abr/2003",0)  as  "Abr/2003" ,
  coalesce("Mai/2003",0)  as  "Mai/2003" ,
  coalesce("Jun/2003",0)  as  "Jun/2003" ,
  coalesce("Jul/2003",0)  as  "Jul/2003" ,
  coalesce("Ago/2003",0)  as  "Ago/2003" ,
  coalesce("Set/2003",0)  as  "Set/2003" ,
  coalesce("Out/2003",0)  as  "Out/2003" ,
  coalesce("Nov/2003",0)  as  "Nov/2003" ,
  coalesce("Dez/2003",0)  as  "Dez/2003" ,
  coalesce("Jan/2004",0)  as  "Jan/2004" ,
  coalesce("Fev/2004",0)  as  "Fev/2004" ,
  coalesce("Mar/2004",0)  as  "Mar/2004" ,
  coalesce("Abr/2004",0)  as  "Abr/2004" ,
  coalesce("Mai/2004",0)  as  "Mai/2004" ,
  coalesce("Jun/2004",0)  as  "Jun/2004" ,
  coalesce("Jul/2004",0)  as  "Jul/2004" ,
  coalesce("Ago/2004",0)  as  "Ago/2004" ,
  coalesce("Set/2004",0)  as  "Set/2004" ,
  coalesce("Out/2004",0)  as  "Out/2004" ,
  coalesce("Nov/2004",0)  as  "Nov/2004" ,
  coalesce("Dez/2004",0)  as  "Dez/2004" ,
  coalesce("Jan/2005",0)  as  "Jan/2005" ,
  coalesce("Fev/2005",0)  as  "Fev/2005" ,
  coalesce("Mar/2005",0)  as  "Mar/2005" ,
  coalesce("Abr/2005",0)  as  "Abr/2005" ,
  coalesce("Mai/2005",0)  as  "Mai/2005" ,
  coalesce("Jun/2005",0)  as  "Jun/2005" ,
  coalesce("Jul/2005",0)  as  "Jul/2005" ,
  coalesce("Ago/2005",0)  as  "Ago/2005" ,
  coalesce("Set/2005",0)  as  "Set/2005" ,
  coalesce("Out/2005",0)  as  "Out/2005" ,
  coalesce("Nov/2005",0)  as  "Nov/2005" ,
  coalesce("Dez/2005",0)  as  "Dez/2005" ,
  coalesce("Jan/2006",0)  as  "Jan/2006" ,
  coalesce("Fev/2006",0)  as  "Fev/2006" ,
  coalesce("Mar/2006",0)  as  "Mar/2006" ,
  coalesce("Abr/2006",0)  as  "Abr/2006" ,
  coalesce("Mai/2006",0)  as  "Mai/2006" ,
  coalesce("Jun/2006",0)  as  "Jun/2006" ,
  coalesce("Jul/2006",0)  as  "Jul/2006" ,
  coalesce("Ago/2006",0)  as  "Ago/2006" ,
  coalesce("Set/2006",0)  as  "Set/2006" ,
  coalesce("Out/2006",0)  as  "Out/2006" ,
  coalesce("Nov/2006",0)  as  "Nov/2006" ,
  coalesce("Dez/2006",0)  as  "Dez/2006" ,
  coalesce("Jan/2007",0)  as  "Jan/2007" ,
  coalesce("Fev/2007",0)  as  "Fev/2007" ,
  coalesce("Mar/2007",0)  as  "Mar/2007" ,
  coalesce("Abr/2007",0)  as  "Abr/2007" ,
  coalesce("Mai/2007",0)  as  "Mai/2007" ,
  coalesce("Jun/2007",0)  as  "Jun/2007" ,
  coalesce("Jul/2007",0)  as  "Jul/2007" ,
  coalesce("Ago/2007",0)  as  "Ago/2007" ,
  coalesce("Set/2007",0)  as  "Set/2007" ,
  coalesce("Out/2007",0)  as  "Out/2007" ,
  coalesce("Nov/2007",0)  as  "Nov/2007" ,
  coalesce("Dez/2007",0)  as  "Dez/2007" 
  from crosstab('SELECT acu.cnpj,depara.unid,((cast(acu.ano as integer)-2000-1)*12+cast(acu.mes as integer)) as mes,acu.total_nfe FROM acumulado_data_qtd_nf acu left join depara on depara.cnpj = acu.cnpj order by acu.cnpj ',
                'select m from generate_series(1,84) m') as  ct(
  "CNPJ" text,
  "UNIDADE" text,
   "Jan/2001" numeric(10,2),
  "Fev/2001" numeric(10,2),
  "Mar/2001" numeric(10,2),
  "Abr/2001" numeric(10,2),
  "Mai/2001" numeric(10,2),
  "Jun/2001" numeric(10,2),
  "Jul/2001" numeric(10,2),
  "Ago/2001" numeric(10,2),
  "Set/2001" numeric(10,2),
  "Out/2001" numeric(10,2),
  "Nov/2001" numeric(10,2),
  "Dez/2001" numeric(10,2),
  "Jan/2002" numeric(10,2),
  "Fev/2002" numeric(10,2),
  "Mar/2002" numeric(10,2),
  "Abr/2002" numeric(10,2),
  "Mai/2002" numeric(10,2),
  "Jun/2002" numeric(10,2),
  "Jul/2002" numeric(10,2),
  "Ago/2002" numeric(10,2),
  "Set/2002" numeric(10,2),
  "Out/2002" numeric(10,2),
  "Nov/2002" numeric(10,2),
  "Dez/2002" numeric(10,2),
  "Jan/2003" numeric(10,2),
  "Fev/2003" numeric(10,2),
  "Mar/2003" numeric(10,2),
  "Abr/2003" numeric(10,2),
  "Mai/2003" numeric(10,2),
  "Jun/2003" numeric(10,2),
  "Jul/2003" numeric(10,2),
  "Ago/2003" numeric(10,2),
  "Set/2003" numeric(10,2),
  "Out/2003" numeric(10,2),
  "Nov/2003" numeric(10,2),
  "Dez/2003" numeric(10,2),
  "Jan/2004" numeric(10,2),
  "Fev/2004" numeric(10,2),
  "Mar/2004" numeric(10,2),
  "Abr/2004" numeric(10,2),
  "Mai/2004" numeric(10,2),
  "Jun/2004" numeric(10,2),
  "Jul/2004" numeric(10,2),
  "Ago/2004" numeric(10,2),
  "Set/2004" numeric(10,2),
  "Out/2004" numeric(10,2),
  "Nov/2004" numeric(10,2),
  "Dez/2004" numeric(10,2),
  "Jan/2005" numeric(10,2),
  "Fev/2005" numeric(10,2),
  "Mar/2005" numeric(10,2),
  "Abr/2005" numeric(10,2),
  "Mai/2005" numeric(10,2),
  "Jun/2005" numeric(10,2),
  "Jul/2005" numeric(10,2),
  "Ago/2005" numeric(10,2),
  "Set/2005" numeric(10,2),
  "Out/2005" numeric(10,2),
  "Nov/2005" numeric(10,2),
  "Dez/2005" numeric(10,2),
  "Jan/2006" numeric(10,2),
  "Fev/2006" numeric(10,2),
  "Mar/2006" numeric(10,2),
  "Abr/2006" numeric(10,2),
  "Mai/2006" numeric(10,2),
  "Jun/2006" numeric(10,2),
  "Jul/2006" numeric(10,2),
  "Ago/2006" numeric(10,2),
  "Set/2006" numeric(10,2),
  "Out/2006" numeric(10,2),
  "Nov/2006" numeric(10,2),
  "Dez/2006" numeric(10,2),
  "Jan/2007" numeric(10,2),
  "Fev/2007" numeric(10,2),
  "Mar/2007" numeric(10,2),
  "Abr/2007" numeric(10,2),
  "Mai/2007" numeric(10,2),
  "Jun/2007" numeric(10,2),
  "Jul/2007" numeric(10,2),
  "Ago/2007" numeric(10,2),
  "Set/2007" numeric(10,2),
  "Out/2007" numeric(10,2),
  "Nov/2007" numeric(10,2),
  "Dez/2007" numeric(10,2)
);
GO

//só 2022
select
  "CNPJ",
  "UNIDADE",
  "EMPRESA",
  coalesce("Jan/2022",0)  as  "Jan/2022" ,
  coalesce("Fev/2022",0)  as  "Fev/2022" ,
  coalesce("Mar/2022",0)  as  "Mar/2022" ,
  coalesce("Abr/2022",0)  as  "Abr/2022" ,
  coalesce("Mai/2022",0)  as  "Mai/2022" ,
  coalesce("Jun/2022",0)  as  "Jun/2022" ,
  coalesce("Jul/2022",0)  as  "Jul/2022" ,
  coalesce("Ago/2022",0)  as  "Ago/2022" ,
  coalesce("Set/2022",0)  as  "Set/2022" ,
  coalesce("Out/2022",0)  as  "Out/2022" ,
  coalesce("Nov/2022",0)  as  "Nov/2022" ,
  coalesce("Dez/2022",0)  as  "Dez/2022" 
  from crosstab('SELECT acu.cnpj,depara.unid,depara.empresa,((cast(acu.ano as integer)-2021-1)*12+cast(acu.mes as integer)) as mes,acu.total_nfe FROM acumulado_data_qtd_nf acu left join depara on depara.cnpj = acu.cnpj order by acu.cnpj ',
                'select m from generate_series(1,12) m') as  ct(
  "CNPJ" text,
  "UNIDADE" text,
  "EMPRESA" text,
  "Jan/2022" numeric(10,2),
  "Fev/2022" numeric(10,2),
  "Mar/2022" numeric(10,2),
  "Abr/2022" numeric(10,2),
  "Mai/2022" numeric(10,2),
  "Jun/2022" numeric(10,2),
  "Jul/2022" numeric(10,2),
  "Ago/2022" numeric(10,2),
  "Set/2022" numeric(10,2),
  "Out/2022" numeric(10,2),
  "Nov/2022" numeric(10,2),
  "Dez/2022" numeric(10,2)
);
GO
